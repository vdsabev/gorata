{
  "rules": {
    ".read": false,
    ".write": false,

    // Requests
    "requests": {
      ".read": true,
      ".indexOn": "status",

      "$requestId": {
        // TODO: Allow the user who created the request to edit it
        // data.child('createdBy').val() === auth.uid
        ".write": "auth != null && (!data.exists() || root.child('userRoles/' + auth.uid).val() === 'moderator' || root.child('userRoles/' + auth.uid).val() === 'admin')",
        ".validate": "newData.hasChildren(['title', 'text', 'geo', 'created', 'createdBy'])",

        "imageUrls": {
          "$imageUrl": { ".validate": "newData.isString()" }
        },
        "title": { ".validate": "newData.isString()" },
        "text": { ".validate": "newData.isString()" },
        "geo": {
          ".validate": "newData.hasChildren(['lat', 'lng'])",

          "lat": { ".validate": "-90 <= newData.val() && newData.val() <= 90" },
          "lng": { ".validate": "-180 <= newData.val() && newData.val() <= 180" }
        },
        "created": { ".validate": "newData.val() === now" },
        "createdBy": { ".validate": "newData.val() === auth.uid" },
        "status": { ".validate": "(!data.exists() && newData.val() === 'new') || (data.exists() && (newData.val() === 'new' || newData.val() === 'approved' || newData.val() === 'declined'))" },

        "$other": { ".validate": false }
      }
    },

    // User Profiles
    "userProfiles": {
      "$userId": {
        ".read": true,
        ".write": "auth.uid === $userId",
        ".validate": "newData.hasChildren(['name'])",

        "name": { ".validate": "newData.isString()" },
        "imageUrl": { ".validate": "newData.isString()" },

        "$other": { ".validate": false }
      }
    },

    // User Roles
    "userRoles": {
      "$userId": {
        ".read": "auth.uid === $userId",
        ".validate": "newData.isString()"
      }
    }
  }
}
